<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tasty.config.mybatis.mapper.MissionMapper">
   <!-- 
      MissionCertBoard관련 mapper
    -->
   
   <resultMap type="missionCert" id="missionCert-resultmap">
      <id column="mission_cert_num" property="missionCertNum"/>
      <result column="email" property="email"/>
      <result column="title" property="title"/>
      <result column="content" property="content"/>
      <result column="mission_num" property="missionNum"/>
   </resultMap>
  
  
  
     <!-- 멤버를 포함한 resultmap -->
   <resultMap type="missionCert" id="missionCert-member-resultmap" extends="missionCert-resultmap">
      <id column="mission_cert_num" property="missionCertNum"/>
      <result column="email" property="email"/>
      <result column="title" property="title"/>
      <result column="content" property="content"/>
      <result column="mission_num" property="missionNum"/>
      <association property="missionMember" javaType="missionMember">
						<id column="mission_num" property="missionNum"/>
						<id column="email" property="email"/>
							<association property="member" javaType="member">
								<id column="email" property="email"/>
								<result column="password" property="password"/>
								<result column="nickname" property="name"/>
								<result column="phone_num" property="phoneNum"/>
								<result column="gender" property="gender"/>
								<result column="total_ups" property="totalUps"/>
								<result column="totalDowns" property="totalDowns"/>
								<result column="member_cert" property="memberCert"/>
							</association>
						<result column="taste_num" property="tasteNum"/>
						<result column="degree_num" property="degreeNum"/>
						<association property="taste" javaType="taste">
							<id column="taste_num" property="tasteNum"/>
							<result column="taste_name" property="tasteName"/>
						</association>
						<association property="degree" javaType="degree">
							<id column="degree_num" property="degreeNum"/>
							<result column="degree" property="degree"/>
						</association>
						
				</association>
   </resultMap>
  
  
  
  
  
  
   <resultMap type="missionCertPhoto" id="missionCert-join-photo-resultmap" extends="missionCert-resultmap">
         <collection property="missionCertPhotoList" ofType="missionCertPhoto">
            <result column="photo_num" property="photoNum"/>
            <result column="mission_cert_num" property="missionCertNum"/>
            <collection property="photoList" ofType="photo">
               <id column="photo_num" property="photoNum"/>
               <result column="photo_path" property="photoPath"/>
            </collection>
         </collection>
   </resultMap>
   
   
   <!-- 미션인증게시판과 , 미션멤버, 미션어드민, 미션포토 , 포토 조인된 resultMap  -->
   <resultMap type="missionCert" id="mission-cert-join-mission-admin-member-resultmap" extends="missionCert-join-photo-resultmap">
	<collection property="mission_admin" ofType="mission">
		<id column="mission_num" property="missionNum"/>
		<result column="mission_name" property="missionName"/>
		<result column="mission_content" property="mission_content"/>
		<result column="current_people" property="currentPeople"/>
		<result column="max_people" property="maxPeople"/>
		<result column="start_date" property="startDate"/>
		<result column="end_date" property="endDate"/>
			<collection property="missionMemberList" ofType="MissionMember">
				<result column="mission_num" property="missionNum"/>
				<result column="email" property="email"/>
					<collection property="member" ofType="member">
						<result column="email" property="email"/>
						<result column="password" property="password"/>
						<result column="nickname" property="name"/>
						<result column="phone_num" property="phoneNum"/>
						<result column="gender" property="gender"/>
						<result column="total_ups" property="totalUps"/>
						<result column="totalDowns" property="totalDowns"/>
						<result column="member_cert" property="memberCert"/>
					</collection>
			</collection>
	</collection>
</resultMap>
   
   
   <!-- 미션인증글의 개수를 조회 -->
    <select id="selectMissionCertCoung" resultType="int">
        SELECT COUNT(*)
        FROM mission_cert_board
    </select>
    
    
    <select id="selectAllMissionCert">
    	select *
    	from mission_cert_board
    </select>
    
     <insert id="insertMissionCert" parameterType="missionCert">
        INSERT INTO
        MISSION_CERT_BOARD(MISSION_CERT_NUM, EMAIL, TITLE, CONTENT, MISSION_NUM)
        VALUES(mission_cert_board_seq.nextval,#{email},#{title},#{content},#{missionNum}) 
    </insert>
    
    
      <update id="updateMissionCertByNum" parameterType="missionCert">
        UPDATE mission_cert_board
            SET
            CONTENT = #{content}
        WHERE mission_cert_num = #{mission
        }
    </update>
    
    <delete id="commentDelete" parameterType="int">
        DELETE FROM COMMENT WHERE CNO = #{cno}
    </delete>
   
   <!-- 미션에 있는 모든 미션인증글 조회 -->
   <select id="selectAllMissionCertPhoto" resultMap="missionCert-join-photo-resultmap"> 
      select * 
      from mission_cert_board, mission_cert_photo
      where mission_cert_board.mission_cert_num = mission_cert_photo.photo_num
   </select>
   


   <select id="selectAllMissionCert" resultMap="missionCert-resultmap">
      select * from mission_cert_board
   </select>
   
   <!-- 미션 인증글 등록  -->
   <insert id="insertMissionCert" parameterType="missionCert">
      INSERT INTO mission_cert_board (mission_cert_num, 
                     email,
                     title,
                     content,
                     mission_num)
      VALUES (
      mission_cert_board_seq.nextval,
            #{email},
            #{title},
            #{content},
            #{mission_num})
   </insert>
   <!-- 미션인증글 미션인증글 번호로 회원이 작성한 작성글내용, 작성 제목 수정 -->
   <update id="updateMissionByMissionCertNum" parameterType="missionCert">
      UPDATE MISSION_CERT_BOARD
      SET  title = #{title},
          content = #{content},
      WHERE mission_cert_num = #{missionCertNum}
   </update>   
   
   <!-- 미션번호로 해당 미션인증글 삭제 -->
   <delete id="deleteMissionCertByMissionCertNum">
         delete from mission_cert_board where mission_cert_num = #{value}
   </delete>
   
      
   <insert id="insertMissionMember" parameterType="missionMember">
      insert into mission_member(mission_num,email)
      values (#{missionNum},#{email})
   </insert>
   

   
   <!-- 해당 미션번호로 인증글 조회 -->
   <select id="selectMissionCertByMissionNum" parameterType="int" resultMap="mission-cert-join-mission-admin-member-resultmap">
      select *
      from mission_cert_board 
      where mission_num = #{missionNum}
   </select>
   
   
   <!-- <select id="selectMissionCertByMissionNum" resultMap="mission-cert-join-mission-admin-member-resultmap">
	select * 
		from mission_member mm, 
			 mission_cert_board mc, 
			 mission_admin ma, 
			 member m,
			 photo p,
			 mission_cert_photo mcp
		where mc.mission_num = 41
		and ma.mission_num=mc.mission_num
		and mcp.mission_cert_num=mc.mission_cert_num
		and mcp.photo_num=p.photo_num(+)
		and mm.email = mc.email
		and m.email = mc.email(+)
		
		order by mc.mission_cert_num desc
   </select>
    -->

</mapper>